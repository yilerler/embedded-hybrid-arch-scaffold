# ğŸš€ Embedded Hybrid Architecture Scaffold (åµŒå…¥å¼ç•°è³ªæ¶æ§‹æ•´åˆéª¨æ¶)

> **ä¸€å¥è©±ç°¡ä»‹ï¼š** å°ˆç‚ºé«˜å¯é åº¦ IoT é‚Šç·£é–˜é“å™¨ (Edge Gateway) è¨­è¨ˆçš„ç³»çµ±éª¨æ¶ã€‚é€éåˆ†é›¢ Linux Kernel Space (ç¡¬å³æ™‚æ§åˆ¶) èˆ‡ User Space (æ¥­å‹™é‚è¼¯)ï¼Œè§£æ±ºå‚³çµ±å–®ä¸€è…³æœ¬æ§åˆ¶ç¡¬é«”æ™‚ç¼ºä¹ç¢ºå®šæ€§ (Determinism) èˆ‡æ•…éšœéš”é›¢ (Fail-Safe) çš„è‡´å‘½ç—›é»ã€‚

## ğŸ—ï¸ ç³»çµ±æ¶æ§‹ (System Architecture)

æœ¬å°ˆæ¡ˆæ¡ç”¨ä¸‰å±¤å¼ç•°è³ªé‹ç®—æ¶æ§‹ï¼š

1. **L1 / æ ¸å¿ƒæ§åˆ¶å±¤ (Kernel Space - C èªè¨€):**
   * è² è²¬ç¡¬å³æ™‚ä»»å‹™ï¼ˆå¦‚ï¼šé›»å­åœç±¬æ„Ÿæ¸¬ã€é¦¬é”å¼·åˆ¶æ–·é›»ï¼‰ã€‚
   * å…·å‚™ **Fail-Safe** ç¨ç«‹é‹ä½œèƒ½åŠ›ï¼Œä¸å—ä¸Šå±¤ç³»çµ±è² è¼‰å½±éŸ¿ã€‚
2. **L2 / æ¥­å‹™é‚è¼¯å±¤ (User Space - Node.js):**
   * é€é `ioctl` ä»‹é¢èˆ‡åº•å±¤é€šè¨Šã€‚
   * è² è²¬éå³æ™‚ä»»å‹™ï¼ˆå¦‚ï¼šç©ºå“/å™ªéŸ³ç›£æ¸¬ã€é–€ç¦ RFID é©—è­‰ï¼‰ã€‚
   * æ“”ä»»è³‡æ–™èšåˆå™¨ (Data Aggregator)ï¼Œæ‰“åŒ…ç³»çµ±ç‹€æ…‹ã€‚
3. **L3 / é›²ç«¯æˆ°æƒ…å±¤ (Cloud Space):**
   * æ¥æ”¶çµæ§‹åŒ–çš„ JSON Payloadï¼Œæ¸²æŸ“ç›£æ§å„€è¡¨æ¿ã€‚

## âœ¨ æ ¸å¿ƒå·¥ç¨‹åƒ¹å€¼ (Key Features)

* ğŸ›¡ï¸ **å·¥å®‰ç´šéš”é›¢ (Safety-Critical Isolation):** ä¿å‘½é‚è¼¯ç›´æ¥åœ¨ Kernel Timer å…§åå°„è§¸ç™¼ï¼Œå¯¦ä½œé›¶å»¶é²çš„ç¡¬é«”é˜²è­·ã€‚
* â±ï¸ **ç¢ºå®šæ€§æ¡æ¨£ (Deterministic Sampling):** æ“ºè„« OS æ’ç¨‹å¸¶ä¾†çš„ Jitterï¼Œç¢ºä¿åº•å±¤æ¯ 100ms çµ•å°åŸ·è¡Œä¸€æ¬¡æ„Ÿæ¸¬ã€‚
* ğŸ”Œ **è»Ÿé«”å®šç¾©ç¡¬é«” (Software-Defined Hardware):** åš´æ ¼å®šç¾© `sensor_ioctl.h` åˆç´„ï¼Œä½¿é‚è¼¯å±¤èˆ‡ç‰©ç†ç¡¬é«”å®Œå…¨è„«é‰¤ã€‚
* ğŸš€ **è™›æ“¬åŒ–é–‹ç™¼ (Mock-Driven Development):** å…§å»ºç¡¬é«”æ¨¡æ“¬å™¨ï¼Œç„¡é ˆé€£æ¥çœŸå¯¦ç¡¬é«”å³å¯é€²è¡Œæ¶æ§‹é©—è­‰ã€‚

## ğŸ“‚ å°ˆæ¡ˆçµæ§‹ (Directory Structure)

```text
.
â”œâ”€â”€ decisions/          # æ¶æ§‹æ±ºç­–ç´€éŒ„ (ADR)
â”œâ”€â”€ kernel/             # Linux LKM é©…å‹•åŸå§‹ç¢¼
â”‚   â”œâ”€â”€ include/        # è·¨å±¤å…±äº«çš„ IOCTL åˆç´„å®šç¾©
â”‚   â””â”€â”€ src/            # mock_sensor.c (ä¿å‘½æ©Ÿåˆ¶èˆ‡è™›æ“¬ç¡¬é«”)
â””â”€â”€ user/               # Node.js é‚Šç·£é‹ç®—å±¤
    â””â”€â”€ adapter.js      # ç³»çµ±è³‡æ–™èšåˆèˆ‡ API è½‰ç™¼
```

## ğŸš€ å¿«é€Ÿå•Ÿå‹• (Getting Started)

**1. ç·¨è­¯èˆ‡è¼‰å…¥æ ¸å¿ƒæ¨¡çµ„ (Kernel Space)**
```bash
cd kernel
make
sudo insmod src/mock_sensor.ko
dmesg | tail # é©—è­‰é©…å‹•æ˜¯å¦å­˜æ´»
```

**2. å•Ÿå‹•é‚Šç·£èšåˆå™¨ (User Space)**
```bash
cd user
npm install
sudo node adapter.js
```

## ğŸ“œ æ¶æ§‹æ±ºç­–ç´€éŒ„ (ADR)
è©³ç´°çš„ç³»çµ±è¨­è¨ˆèˆ‡æŠ€è¡“é¸å‹è€ƒé‡ï¼Œè«‹åƒé–±ï¼š
* [ADR-001: Hybrid Architecture for Safety-Critical Edge Systems](decisions/ADR-001-hybrid-architecture.md)